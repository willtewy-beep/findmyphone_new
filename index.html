<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Find My Phone — Access Portal</title>
  <style>
    :root{--bg:#0f1724;--accent:#7dd3fc;--muted:#9ca3af}
    body{font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#071029 0%, #081526 100%);color:#e6eef6;margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:560px;background:rgba(255,255,255,0.02);border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6);padding:28px}
    .logo{width:54px;height:54px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:700;color:#022}
    h1{margin:0;font-size:20px}
    .row{display:flex;gap:12px;margin-top:18px}
    input[type="text"]{flex:1;padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.03);color:inherit;font-size:15px}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:#022;font-weight:600;cursor:pointer}
    #message{margin-top:10px;height:18px;color:var(--muted)}
    #accessSection{display:none;margin-top:16px}
    .hint{margin-top:12px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="card" role="main">
    <header style="display:flex;align-items:center;gap:14px">
      <div class="logo">FMP</div>
      <div>
        <h1>Find My Phone — Access Portal</h1>
      </div>
    </header>

    <div class="row">
      <input id="phoneInput" type="text" placeholder="" autocomplete="off" />
      <button id="loginBtn">Log in</button>
    </div>

    <div id="message"></div>

    <div id="accessSection">
      <button id="accessBtn">Access Data Logs</button>
      <div class="hint">Click to open the data console. Type <strong>Y</strong> to extract logs.</div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    const allowedNumbers = ['+14165550199','14165550199','4165550199'];
    const phoneInput = document.getElementById('phoneInput');
    const loginBtn = document.getElementById('loginBtn');
    const message = document.getElementById('message');
    const accessSection = document.getElementById('accessSection');
    const accessBtn = document.getElementById('accessBtn');

    function normalizeDigits(s){ return (s||'').replace(/\D/g,''); }

    function tryLogin(){
      message.textContent = '';
      loginBtn.disabled = true;
      loginBtn.textContent = 'Verifying...';
      message.style.color = '#9ca3af';
      message.textContent = 'Checking number...';

      setTimeout(()=>{
        const inputNorm = normalizeDigits(phoneInput.value);
        const ok = allowedNumbers.some(n => normalizeDigits(n) === inputNorm);
        if(ok){
          message.style.color = '#86efac';
          message.textContent = 'Access granted.';
          accessSection.style.display = 'block';
        } else {
          message.style.color = '#fca5a5';
          message.textContent = "That number isn't recognized.";
          accessSection.style.display = 'none';
        }
        loginBtn.disabled = false;
        loginBtn.textContent = 'Log in';
      }, 1200);
    }

    loginBtn.addEventListener('click', tryLogin);
    phoneInput.addEventListener('keydown', e => { if(e.key === 'Enter') tryLogin(); });

    accessBtn.addEventListener('click', () => openFakeShellWindow());

    function openFakeShellWindow(){
      const win = window.open('', '_blank', 'toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes,width=900,height=520');
      if(!win){ alert('Popup blocked. Allow popups for this site.'); return; }

      const head = `
        <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Data Console — FindMyPhone</title>
        <style>
          body{margin:0;height:100vh;background:#0b1220;color:#dff3ff;font-family:Consolas,monaco,monospace;}
          .title{background:#06202b;padding:8px 12px;color:#e6eef6;font-weight:700;}
          .term{padding:12px;overflow:auto;height:calc(100vh - 70px);white-space:pre-wrap;}
          .line{line-height:1.5em;}
          .muted{color:#9ca3af;font-size:13px;margin-top:8px;}
          .btn{margin-top:10px;padding:8px 12px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:#082032;color:#e6eef6;cursor:pointer}
        </style></head><body>
        <div class="title">PowerShell — FindMyPhone Data Console</div>
        <div id="term" class="term" tabindex="0"></div>
        <div style="padding:10px;">
          <button id="downloadBtn" class="btn" style="display:none">Download data log (.jsonl)</button>
          <div id="encLine" class="muted" style="display:none">JSON encryption - active. Base64 viewer recommended for extraction.</div>
        </div>
      `;

      win.document.write(head);

      // helper script in popup: safe string (no backticks)
      const popupScript = `
      (function(){
        const term = document.getElementById('term');
        const downloadBtn = document.getElementById('downloadBtn');
        const encLine = document.getElementById('encLine');

        function appendLine(txt){
          const div = document.createElement('div');
          div.className = 'line';
          div.textContent = txt;
          term.appendChild(div);
          term.scrollTop = term.scrollHeight;
        }

        function typeLine(text, speed){
          return new Promise(resolve => {
            const div = document.createElement('div');
            div.className = 'line';
            term.appendChild(div);
            term.scrollTop = term.scrollHeight;
            let i = 0;
            (function step(){
              if(i <= text.length){
                div.textContent = text.slice(0,i);
                term.scrollTop = term.scrollHeight;
                i++;
                setTimeout(step, speed);
              } else resolve();
            })();
          });
        }

        // NMEA helper
        function nmeaChecksum(s){
          let cs = 0;
          for(let i=0;i<s.length;i++){ cs ^= s.charCodeAt(i); }
          let hex = cs.toString(16).toUpperCase();
          if(hex.length===1) hex = '0'+hex;
          return hex;
        }
        function toNmeaLat(dd){
          const hemi = dd >= 0 ? 'N' : 'S';
          const a = Math.abs(dd);
          const deg = Math.floor(a);
          const min = (a - deg) * 60;
          const minStr = min.toFixed(4).padStart(7,'0');
          const degStr = deg.toString().padStart(2,'0');
          return degStr + minStr + ',' + hemi;
        }
        function toNmeaLon(dd){
          const hemi = dd >= 0 ? 'E' : 'W';
          const a = Math.abs(dd);
          const deg = Math.floor(a);
          const min = (a - deg) * 60;
          const minStr = min.toFixed(4).padStart(7,'0');
          const degStr = deg.toString().padStart(3,'0');
          return degStr + minStr + ',' + hemi;
        }

        // Build final JSON object (fixed timestamp & coords)
        function buildJsonObject(){
          const iso = '2025-10-28T03:00:00Z';
          const lat = 45.50899;
          const lon = -73.586669;
          const timeStr = '030000.00';
          const dateStr = '281025';
          const latPair = toNmeaLat(lat);
          const lonPair = toNmeaLon(lon);
          const payload = 'GPRMC,' + timeStr + ',A,' + latPair + ',' + lonPair + ',0.0,0.0,' + dateStr + ',,';
          const cs = nmeaChecksum(payload);
          const raw = '$' + payload + '*' + cs;
          return { timestamp_utc: iso, name: 'RachelLang', lat: lat, lon: lon, raw: raw };
        }

        function base64Encode(str){
          try {
            return btoa(unescape(encodeURIComponent(str)));
          } catch(e){
            // fallback
            return btoa(str);
          }
        }

        function buildBase64JsonLine(){
          const obj = buildJsonObject();
          const json = JSON.stringify(obj);
          return base64Encode(json);
        }

        async function runSequence(){
          await typeLine('[ ] Initializing GPS module...',12); await new Promise(r=>setTimeout(r,350));
          await typeLine('[✓] Initializing GPS module...',12); await new Promise(r=>setTimeout(r,200));

          await typeLine('[ ] Decrypting location data...',12); await new Promise(r=>setTimeout(r,450));
          await typeLine('[✓] Decrypting location data...',12); await new Promise(r=>setTimeout(r,200));

          await typeLine('[ ] Preparing JSON payload...',12); await new Promise(r=>setTimeout(r,350));
          await typeLine('[ ] Encrypting JSON payload (Base64)...',12); await new Promise(r=>setTimeout(r,500));
          await typeLine('[✓] Encrypting JSON payload (Base64)... Done.',12); await new Promise(r=>setTimeout(r,250));

          await typeLine('[ ] Formatting timestamps...',12); await new Promise(r=>setTimeout(r,300));
          await typeLine('[✓] Formatting timestamps...',12); await new Promise(r=>setTimeout(r,200));

          await typeLine('[ ] Finalizing...',12); await new Promise(r=>setTimeout(r,450));

          appendLine('');
          appendLine('Data logs prepared:');
          appendLine('  findmyphone_log.jsonl');
          appendLine('');
          appendLine('JSON encryption - active. JSON viewer recommended for extraction.');
          appendLine('');
          appendLine('Access data logs? (Y/N)');
          encLine.style.display = 'block';
          downloadBtn.style.display = 'inline-block';

          // prompt UI
          const promptDiv = document.createElement('div'); promptDiv.className='line';
          const promptLabel = document.createElement('span'); promptLabel.textContent = '> ';
          const inputSpan = document.createElement('span'); inputSpan.style.borderBottom='1px dashed rgba(255,255,255,0.2)'; inputSpan.style.paddingLeft='4px';
          promptDiv.appendChild(promptLabel); promptDiv.appendChild(inputSpan); term.appendChild(promptDiv);
          term.scrollTop = term.scrollHeight;

          let captured = '';
          function keyHandler(e){
            const k = e.key;
            if(k.length===1){
              captured += k;
              inputSpan.textContent = captured;
            } else if(k === 'Backspace'){
              captured = captured.slice(0,-1);
              inputSpan.textContent = captured;
            } else if(k === 'Enter'){
              const val = captured.trim();
              if(val.toLowerCase() === 'y'){
                appendLine('');
                appendLine('Starting download...');
                const b64 = buildBase64JsonLine() + '\\n';
                const blob = new Blob([b64], {type:'application/octet-stream'});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'findmyphone_log.jsonl';
                document.body.appendChild(a); a.click(); a.remove();
                setTimeout(()=>URL.revokeObjectURL(a.href),3000);
                appendLine('');
                appendLine('Download complete. Check your Downloads folder.');
                appendLine('');
                appendLine('Press Enter to continue (this window will remain open).');
                document.removeEventListener('keydown', keyHandler);
              } else {
                appendLine('');
                appendLine('Aborted by user.');
                appendLine('');
                appendLine('Press Enter to continue (this window will remain open).');
                document.removeEventListener('keydown', keyHandler);
              }
            }
            term.scrollTop = term.scrollHeight;
          }
          document.addEventListener('keydown', keyHandler);
        }

        runSequence();

        // also allow clicking the download button after sequence (decodes base64 then triggers)
        downloadBtn.addEventListener('click', function(){
          const b64 = buildBase64JsonLine() + '\\n';
          const blob = new Blob([b64], {type:'application/octet-stream'});
          const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'findmyphone_log.jsonl'; document.body.appendChild(a); a.click(); a.remove();
          setTimeout(()=>URL.revokeObjectURL(a.href),3000);
          appendLine('');
          appendLine('Download complete. Check your Downloads folder.');
        });
      })();
      `;
      // inject helper script safely
      const scriptEl = win.document.createElement('script');
      scriptEl.type = 'text/javascript';
      scriptEl.text = popupScript;
      win.document.body.appendChild(scriptEl);
      win.document.close();
    } // end openFakeShellWindow
  }); // end DOMContentLoaded
  </script>
</body>
</html>
